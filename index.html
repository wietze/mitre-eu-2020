<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="copyright"
  content="@Wietze - October 2020" />
  <meta name="author" content="Wietze Beukema" />
  <title>Hijacking DLLs in Windows</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="https://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
   href="css/pwc.css" />
<script src="https://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js" charset="utf-8" type="text/javascript"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script type="text/javascript">jQuery(function() {
  function onLoad (){
    jQuery("div.slide:has(p > img.split)").attr("style", "padding-right: calc(40% + 40px) !important");
    if(jQuery("div.slide>div.footer").length==0){
      jQuery("div.slide").not(".finalpage").not(".titlepage").append("<div class='footer'><div>@Wietze<br />October 2020</div><div><img src='img/pwc.png' alt='PwC' style='height: 3em;'></div></div>"); }
      jQuery("div.toolbar").not(".hidden").addClass("hidden");
      }
      onLoad(); });</script>
</head>
<body>
<div class="slide titlepage  one ">
<div class="bg" style="background-image:url(img/dlls.png);"></div>
<div id="block3" class="block">
  <h1 class="title">Hijacking DLLs in Windows</h1>
  <p class="author">
Wietze Beukema
  </p>
  <p class="date">October 2020</p>
<div id="pwc-logo"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMkAAACmCAMAAAEwvWsuAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALcUExURQAAAP7+/v////7+/v7+/v7+/v7+/v7+/v7+/v////7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v////7+/v7+/v7+/v////7+/v////7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v////7+/v7+/v7+/v7+/v7+/v7+/v7+/v////7+/v7+/v////7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v////7+/v////7+/v7+/v////7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v////7+/v7+/v////7+/v7+/v7+/v7+/v////7+/v7+/v7+/v7+/v7+/v7+/v////7+/v7+/v7+/v7+/v7+/v7+/v7+/v////7+/v7+/v7+/v////7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v////7+/v7+/v7+/v7+/v////7+/v7+/v7+/v7+/v7+/v////7+/v////7+/v7+/v7+/v7+/v7+/v7+/v////7+/v7+/v////7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v////7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v////7+/v7+/v7+/v7+/v7+/v////7+/v7+/v////7+/v7+/v////7+/v7+/v7+/v7+/v////7+/v7+/v7+/v7+/v////7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v////7+/v7+/v////7+/v7+/v7+/v////7+/v7+/v7+/v7+/v////7+/v7+/v7+/v7+/v7+/v7+/v////7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v////7+/v7+/v7+/q+2TQAAAAD0dFJOUwCvQBpbB91IifDKNXa3+GOk5ZEi0j1+D79QKmusF+1YmdpFhscycwS0H/Wh4k3PYDp7DLwn/Wip6tdCgxTEVS9wAbEc8l2eCd9Kize5JPplzKbneFKT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" alt="PwC Logo" /></div>
</div>
</div>
<h1 id="hello-who-dis">Hello, who dis?</h1>
<h3 id="wietze-beukema">Wietze Beukema</h3>
<ul>
<li>Threat Hunting</li>
<li>Detection Engineering &amp; Research</li>
<li>PwC UK, London</li>
</ul>
<p><br /><br /> Keep in touch:</p>
<p><img src="img/twitter.svg" alt="social" /> <a href="https://www.twitter.com/wietze">@Wietze</a></p>
<p><img src="img/github.svg" alt="social" /> <a href="https://github.com/wietze">github.com/wietze</a></p>
<p><img src="img/email.svg" alt="social" /> <a href="mailto:wietze.beukema@pwc.com">wietze.beukema@pwc.com</a></p>
<h1 id="dll-hijacking">üëæ DLL Hijacking</h1>
<h1 id="dll-hijacking-1">DLL Hijacking</h1>
<p>‚ÄúTricking a legitimate/trusted application into loading an arbitrary DLL‚Äù</p>
<h1 id="whats-in-a-name">What‚Äôs in a name?</h1>
<figure>
<img src="img/name.png" alt="_" class="full-width-title" /><figcaption>_</figcaption>
</figure>
<h1 id="dll-hijacking-2">DLL Hijacking (2)</h1>
<ul>
<li><strong>T1574</strong>: Hijack Execution Flow
<ul>
<li><strong>T1574.001</strong>: DLL Search Order Hijacking</li>
<li><strong>T1574.002</strong>: DLL Side-Loading</li>
</ul></li>
<li><strong>T1218</strong>: Signed Binary Proxy Execution (?)</li>
<li><strong>T1036</strong>: Masquerading</li>
</ul>
<p><img src="img/attack.png" /></p>
<h1 id="dll-hijacking-3">DLL Hijacking (3)</h1>
<h2 id="but-why">But why?</h2>
<ul>
<li>Your evil code, executed by a trusted executable</li>
<li>Great for Execution, Persistence, Privilege Escalation</li>
<li>The threat is real</li>
</ul>
<h1 id="types" class="emphasis">Types</h1>
<h2 id="a-few-common-ones">A few common ones</h2>
<table>
<colgroup>
<col style="width: 26%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1: <strong>DLL replacement</strong></td>
<td>Replace a legitimate DLL with the evil DLL.</td>
</tr>
<tr class="even">
<td>2: <strong>DLL search order hijacking</strong></td>
<td>Place the evil DLL in a location that is ched for before the legitimate DLL.</td>
</tr>
<tr class="odd">
<td>3: <strong>Phantom DLL Hijacking</strong></td>
<td>Drop the evil DLL in place of a missing/existing DLL that a legitimate application tries to load.</td>
</tr>
<tr class="even">
<td>4: <strong>DLL redirection</strong></td>
<td>Change the location in which the DLL is searched for, by editing the %PATH% environment variable or .exe.manifest / .exe.local.</td>
</tr>
<tr class="odd">
<td>5: <strong>WinSxS DLL replacement</strong> (<em>‚ÄòDLL side-loading‚Äô</em>)</td>
<td>Replace the legitimate with the evil DLL in the relevant WinSxS folder of the targeted DLL.</td>
</tr>
<tr class="even">
<td>6: <strong>Relative path DLL Hijacking</strong></td>
<td>Copy (and optionally rename) the legitimate application to a user-writeable folder, alongside the evil DLL.</td>
</tr>
</tbody>
</table>
<h1 id="types-1">Types</h1>
<h2 id="dll-replacement">1: DLL replacement</h2>
<blockquote>
<p>‚ÄúReplace a legitimate DLL with the evil DLL.‚Äù</p>
</blockquote>
<ul>
<li>Most basic type</li>
<li>Could run DLL with high integrity (although replacement usually requires this too)</li>
<li>Often used together with DLL Proxying [<a href="https://kevinalmansa.github.io/application%20security/DLL-Proxying/">1</a>].</li>
</ul>
<h3 id="example" class="emphasis">Example</h3>
<p>Stuxnet: renamed legitimate Siemens DLL <code>S7OTBXDX.DLL</code> in <code>c:\windows\</code> and added its own malicious version, implementing all exports but with modified logic when interacting with the PLC [<a href="https://www.trendmicro.com/vinfo/de/threat-encyclopedia/web-attack/54/stuxnet-malware-targets-scada-systems">2</a>]. <em>Execution</em> + <em>Persistence</em>!</p>
<p><img src="img/dll.png" class="split" /></p>
<h1 id="types-2">Types</h1>
<h2 id="dll-search-order-hijacking-t1574.001">2: DLL search order hijacking (T1574.001)</h2>
<blockquote>
<p>‚ÄúPlace the evil DLL in a location that is searched for before the legitimate DLL.‚Äù</p>
</blockquote>
<ul>
<li>Look at the <em>DLL search order</em>: (1) Directory of application ‚Üí (2) System32 directory ‚Üí (3) System directory ‚Üí (4) Windows directory ‚Üí (5) Current directory ‚Üí (6) <code>%PATH%</code></li>
<li>CVE potential: especially executables running with high integrity</li>
<li>Good way to find these: look for <code>FILE NOT FOUND</code> in Procmon</li>
</ul>
<h3 id="example-1" class="emphasis">Example</h3>
<p>Vault7 Leaks: portable Chrome tries to load <code>DWrite.dll</code>, located in <code>System32\</code>. Because no absolute path is specified, the directory of the application is tried first [<a href="https://wikileaks.org/ciav7p1/cms/page_27492385.html">3</a>]. <em>Execution</em> (+ <em>Persistence</em>)!</p>
<h1 id="types-3">Types</h1>
<h2 id="phantom-dll-hijacking">3: Phantom DLL Hijacking</h2>
<blockquote>
<p>‚ÄúDrop the evil DLL in place of a missing/non-existing DLL that a legitimate application tries to load.‚Äù</p>
</blockquote>
<ul>
<li>More rare, yet not uncommon</li>
<li>Less likely your DLL will break the running application</li>
<li>CVE potential</li>
</ul>
<h3 id="example-2" class="emphasis">Example</h3>
<p>Vault7 leaks: Kaspersky process <code>avp.exe</code> intended to load <code>WHEAPGRD.DLL</code>. Due to a bug, it would prepend the drive letter, meaning it would try to load non-existing file <code>CWHEAPGRD.DLL</code> [<a href="https://wikileaks.org/ciav7p1/cms/page_3375327.html">4</a>]. <em>Execution</em> + <em>Persistence</em> (+ <em>Elevation?</em>)</p>
<h1 id="types-4">Types</h1>
<h2 id="dll-redirection">4: DLL redirection</h2>
<blockquote>
<p>‚ÄúChange the location in which the DLL is searched for, by editing %PATH% or .exe.manifest / .exe.local.‚Äù</p>
</blockquote>
<h1 id="types-5">Types</h1>
<h2 id="winsxs-dll-replacement-t1574.002">5: WinSxS DLL replacement (T1574.002)</h2>
<blockquote>
<p>‚ÄúReplace the legitimate with the evil DLL in the relevant WinSxS folder of the targeted DLL.‚Äù</p>
</blockquote>
<ul>
<li>Sometimes referred to as ‚ÄòDLL Side-Loading‚Äô [<a href="https://www.fireeye.com/content/dam/fireeye-www/global/en/current-threats/pdfs/rpt-dll-sideloading.pdf">5</a>]</li>
</ul>
<p><img src="img/sideloading.png" /></p>
<h1 id="types-6">Types</h1>
<h2 id="relative-path-dll-hijacking">6: Relative path DLL Hijacking</h2>
<blockquote>
<p>‚ÄúCopy (and optionally rename) the legitimate application to a user-writeable folder, alongside the evil DLL.‚Äù</p>
</blockquote>
<div class="incremental">
<ul class="incremental">
<li>Simple: DLL Hijacking with least preconditions</li>
<li>No CVE/LOLbin potential, yet very powerful</li>
<li>Combine with other techniques for more impact, e.g.¬†UAC bypass</li>
</ul>
<h3 id="example-3" class="emphasis">Example</h3>
<p>PwC Threat Intelligence observed a dropper (‚ÄòxStart‚Äô) used by a threat actor targetting Chinese organisations to deliver Cobalt Strike payloads. Through phishing, a user is tricked into opening a legitimate (but renamed) <code>winword.exe</code> that is put alongside a malicious alongside a malicious <code>wwlib.dll</code>. When the renamed <code>winword.exe</code> is executed, <code>wwlib.dll</code> is triggered, starting phase 2 of the attack [<a href="https://www.pwc.co.uk/issues/cyber-security-services/cyber-threat-intelligence.html">6</a>]. <em>Execution</em>!</p>
<p><img src="img/vt.png" class="split" /></p>
</div>
<h1 id="types-7">Types</h1>
<h2 id="relative-path-dll-hijacking-2">6: Relative path DLL Hijacking (2)</h2>
<blockquote>
<p>‚ÄúCopy (and optionally rename) the legitimate application to a user-writeable folder, alongside the evil DLL.‚Äù</p>
</blockquote>
<ul>
<li><p>Nearly 300 (!) <code>system32\</code> executables are vulnerable to this [<a href="https://wietze.github.io/blog/hijacking-dlls-in-windows">7</a>]</p></li>
<li><p>Many, many more outside this dir, as well as non-Microsoft (see Hexacorn et al.)</p></li>
<li><p>Can be combined with UAC bypass techniques</p></li>
</ul>
<p><img src="img/procmon.png" class="center" /></p>
<h1 id="types-8">Types</h1>
<h2 id="relative-path-dll-hijacking-3">6: Relative path DLL Hijacking (3)</h2>
<blockquote>
<p>‚ÄúCopy (and optionally rename) the legitimate application to a user-writeable folder, alongside the evil DLL.‚Äù</p>
</blockquote>
<p>This poses a problem:</p>
<ul>
<li>Relies on legitimate executables</li>
<li>Many possible candidates</li>
<li>Actively used in the wild</li>
<li>Impact is medium to high</li>
</ul>
<p>So how to prevent / detect this?</p>
<p><img src="img/blog.png" class="split" /></p>
<h1 id="prevention-detection">üß≠ Prevention &amp; Detection</h1>
<h1 id="preventing-dll-hijacking">Preventing DLL Hijacking</h1>
<table style="width:94%;">
<colgroup>
<col style="width: 47%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>üîß Developers</strong></th>
<th><strong>üë©‚Äçüíª üë®‚Äçüíª System admins</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Use absolute DLL paths where possible<br /> <em>e.g.¬†</em><code>system32\</code><em> DLLs, environment variables if needed</em></td>
<td>Use <code>PreferSystem32Images</code> and <code>MicrosoftSignedOnly</code> /<code>StoreSignedOnly</code> process mitigations? [<a href="https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-updateprocthreadattribute">8</a>]</td>
</tr>
<tr class="even">
<td>Verify validity of DLL<br /> <em>i.e.¬†check expected signature</em></td>
<td></td>
</tr>
</tbody>
</table>
<p><br /><br /></p>
<h3 id="nevertheless-the-problem-remains" class="emphasis">Nevertheless: the problem remains!</h3>
<h1 id="detecting-dll-hijacking">Detecting DLL Hijacking</h1>
<h2 id="its-not-straightforward">It‚Äôs not straightforward‚Ä¶</h2>
<p>A few (flawed) ideas:</p>
<ul>
<li>Look for known DLL hijack targets (DLL names, executables) - see [<a href="https://github.com/wietze/windows-dll-hijacking/blob/master/possible_windows_dll_hijacking.yml">9</a>]</li>
<li>Look for creation of DLLs by unexpected processes</li>
<li>Look for common targets (e.g.¬†Microsoft-signed executables) in unexpected locations</li>
<li>Look for common targets loading DLLs not on VT</li>
<li>‚Ä¶</li>
</ul>
<p><img src="img/sigma.png" class="split" /></p>
<h1 id="detecting-dll-hijacking-2">Detecting DLL Hijacking (2)</h1>
<h2 id="but-not-impossible">‚Ä¶ but not impossible</h2>
<ul>
<li><p>üîé Instead of just looking for the DLL Hijacking, look for the <strong>behaviour that follows</strong></p></li>
<li><p>üìö <strong>Layer your defences</strong>!</p></li>
<li><p>üõ°Ô∏è Ensure a <strong>broad base</strong> of behavioural rules, hunting techniques, anomaly detection</p>
<ul>
<li>You‚Äôre never going to detect everything</li>
<li>The more you monitor, the less likely an intrusion will go undetected</li>
</ul></li>
</ul>

<div class="slide finalpage">
    <h1>Thank you</h1>
    <div></div>
    <div class="copyright-box"><div>This content is for general information purposes only, and should not be used as a substitute for consultation with professional advisors.<br /><br />¬© 2020 PricewaterhouseCoopers LLP. All rights reserved. PwC refers to the UK member firm, and may sometimes refer to the PwC network. Each member firm is a separate legal entity. Please see www.pwc.com/structure for further details.</div></div>
</div>


</body>
</html>
